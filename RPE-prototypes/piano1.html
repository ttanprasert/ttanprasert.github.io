<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>PROTOTYPE 1</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">
  <link rel="stylesheet" href="css/custom.css">
  <link rel="stylesheet" href="css/jquery.Jcrop.css">

  <!-- Scripts
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="./jquery.Jcrop.js"></script>
  <script async src="https://www.youtube.com/iframe_api"></script>
  <script src="./data.js"></script>

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="images/favicon.png">

</head>
<body>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->

  <div class="section categories">
    <div class="container">
      <h2 class="section-heading">IDEA 1 PROTOTYPE</h2>
      <h5 class="section-heading">Score-based navigation and progress tracking </h5>
      <p class="section-description">
        The system presents the printout of annotation to navigate videos. 
        The learner can highlight a segment of the score and go to explanation or demonstration of that part in the video directly. 
        Moreover, the learner could color-code the part of the score that they have finished learning, playing the part at slow speed, 
        or playing at original speed. This will allow users to see annotation as references in their practices, monitor their progress, 
        and allow for a more effective semantic-based navigation. 
      </p><br>

      <h5 class="section-heading">Tool Manual</h5>
      <ul style="list-style-type:square; text-align:left;">
        <li> When you play the video, the red bar on the score will move accordingly. </li>
        <li> To navigate the video with the score, click the "Select regions" button and drag a box over the region you would like to select.
             You will see the area of the score that you select darkened. You can select the score in multiple lines. The video will start playing
             from the beginning of the selected area. </li>
        <li> Click the "Repeat segment" button to automatically loop the part of the score that you select. </li>
        <li> Click the "Stop repeat" button (same button) to stop the loop. </li>
        <li> While some region is selected, you can highlight the region to mark your progress. Click "Got it" to mark it green or "Not yet" to mark it yellow.
             Click "clear" to remove green/yellow highlight of the region. </li>
        <li> Click the "Reset regions" button to deselect the region and continue playing beyond the segment. </li>
      </ul>
      </p><br><br>

      <div class="row">

        <!-- Sheet music panel -->
        <div class="five columns">
          <div class="wrapper">
            <img class="u max full width" id="target" src="images/dannyboy-piano-1.png" width=100% alt="">
            <div class="vl" id="cursor-line" style="left: 128px; top: 80px"></div>
            <div class="box" id="area00" style="top:80px; left:130px; width:11px; height:52px; background-color: transparent"></div>
            <div class="box" id="area01" style="top:80px; left:141px; width:7px; height:52px; background-color: transparent"></div>
            <div class="box" id="area02" style="top:80px; left:148px; width:13px; height:52px; background-color: transparent"></div>
            <div class="box" id="area10" style="top:80px; left:161px; width:19px; height:52px; background-color: transparent"></div>
            <div class="box" id="area11" style="top:80px; left:180px; width:7px; height:52px; background-color: transparent"></div>
            <div class="box" id="area12" style="top:80px; left:187px; width:11px; height:52px; background-color: transparent"></div>
            <div class="box" id="area13" style="top:80px; left:198px; width:8px; height:52px; background-color: transparent"></div>
            <div class="box" id="area14" style="top:80px; left:206px; width:8px; height:52px; background-color: transparent"></div>
            <div class="box" id="area15" style="top:80px; left:214px; width:15px; height:52px; background-color: transparent"></div>
            <div class="box" id="area20" style="top:80px; left:229px; width:7px; height:52px; background-color: transparent"></div>
            <div class="box" id="area21" style="top:80px; left:236px; width:9px; height:52px; background-color: transparent"></div>
            <div class="box" id="area22" style="top:80px; left:245px; width:23px; height:52px; background-color: transparent"></div>
            <div class="box" id="area23" style="top:80px; left:268px; width:7px; height:52px; background-color: transparent"></div>
            <div class="box" id="area24" style="top:80px; left:275px; width:9px; height:52px; background-color: transparent"></div>
            <div class="box" id="area25" style="top:80px; left:284px; width:13px; height:52px; background-color: transparent"></div>
            <div class="box" id="area30" style="top:80px; left:297px; width:17px; height:52px; background-color: transparent"></div>
            <div class="box" id="area31" style="top:80px; left:314px; width:7px; height:52px; background-color: transparent"></div>
            <div class="box" id="area32" style="top:80px; left:321px; width:11px; height:52px; background-color: transparent"></div>
            <div class="box" id="area33" style="top:80px; left:332px; width:8px; height:52px; background-color: transparent"></div>
            <div class="box" id="area34" style="top:80px; left:340px; width:9px; height:52px; background-color: transparent"></div>
            <div class="box" id="area35" style="top:80px; left:349px; width:5px; height:52px; background-color: transparent"></div>
            <div class="box" id="area40" style="top:185px; left:69px; width:12px; height:52px; background-color: transparent"></div>
            <div class="box" id="area41" style="top:185px; left:81px; width:12px; height:52px; background-color: transparent"></div>
            <div class="box" id="area42" style="top:185px; left:93px; width:7px; height:52px; background-color: transparent"></div>
            <div class="box" id="area43" style="top:185px; left:100px; width:7px; height:52px; background-color: transparent"></div>
            <div class="box" id="area44" style="top:185px; left:107px; width:8px; height:52px; background-color: transparent"></div>
            <div class="box" id="area45" style="top:185px; left:115px; width:12px; height:52px; background-color: transparent"></div>
          </div>
          <div class="wrapper">
            <input class="button-primary" type="button" id="selectButton" value="Select regions" onclick="changeSelect()">
          </div>
          <input class="button" type="button" id="markGreen" value="Got it" display="block" onclick="markRegions('g')">
          <input class="button" type="button" id="markYellow" value="Not yet" onclick="markRegions('y')">
          <input class="button" type="button" id="markTpr" value="Clear" onclick="markRegions('c')">

          <script>

            var jcrop_api
            $(window).load(function(){
                jcrop_api = $.Jcrop('#target',{
                    onSelect: getOverlap,
                })
                jcrop_api.disable();
            })

            var startSeconds = 0;
            var endSeconds = 119;
            var areaMap = ["area00", "area01", "area02", "area10", "area11", "area12", "area13", "area14", "area15", "area20", "area21", "area22",
                            "area23", "area24", "area25", "area30", "area31", "area32", "area33", "area34", "area35", "area40", "area41", "area42",
                            "area43", "area44", "area45"];

            var selected;
            var start_ind, end_ind;
            var areaListLen = getNumArea();

            function changeSelect() {
              if (document.getElementById("selectButton").value == "Select regions"){
                jcrop_api.enable();
                selected = true;
                start_ind = 100;
                end_ind = 0;
                document.getElementById("selectButton").value = "Reset regions";
                document.getElementById("markGreen").style.backgroundColor = "white";
                document.getElementById("markYellow").style.backgroundColor = "white";
                document.getElementById("markTpr").style.backgroundColor = "white";
              }
              else {
                jcrop_api.disable();
                markSelected('deselect');
                player.seekTo(0);
                startSeconds = 0;
                endSeconds = 119;
                selected = false;
                document.getElementById("selectButton").value = "Select regions";
                document.getElementById("markGreen").style.backgroundColor = "transparent";
                document.getElementById("markYellow").style.backgroundColor = "transparent";
                document.getElementById("markTpr").style.backgroundColor = "transparent";
              }
            }

            function getOverlap(c) {
              var x1 = c.x;
              var y1 = c.y;
              var x2 = c.x+c.w;
              var y2 = c.y+c.h;
              var loc_start_ind, loc_end_ind;

              for (var i = 0; i < areaListLen; i++) {
                area = getArea(i);
                if (x1 < area.x1 && y1 < area.y1) {
                  loc_start_ind = i;
                  break;
                }
              }
              //console.log([x1, y1, x2, y2]);
              
              for (var i = areaListLen-1; i >= 0; i--) {
                area = getArea(i);
                if (x2 > area.x2 && y2 > area.y2) {
                  loc_end_ind = i;
                  break;
                }
              }

              if (loc_start_ind < start_ind) {
                start_ind = loc_start_ind;
                startSeconds = getArea(start_ind).startTime;
              }

              if (loc_end_ind > end_ind) {
                end_ind = loc_end_ind;
                endSeconds = getArea(end_ind).endTime;
              }

              markSelected('selected');
              jcrop_api.release();

              player.seekTo(startSeconds);
              repeatVar = setInterval(repeatFunc,500);
            }

            function markSelected(status) {
              var origColor;
              if (status == 'selected') {
                for (var i = start_ind; i <= end_ind; i++) {
                  c = getArea(i).color;
                  if (c == 'c') {
                    document.getElementById(areaMap[i]).style.backgroundColor = "#D3D3D399";
                  }
                  if (c == 'y') {
                    document.getElementById(areaMap[i]).style.backgroundColor = "#bcbc0099";
                  }
                  if (c == 'g') {
                    document.getElementById(areaMap[i]).style.backgroundColor = "#49bc2999";
                  }
                }
              }
              else {
                for (var i = start_ind; i <= end_ind; i++) {
                  c = getArea(i).color;
                  if (c == 'c') {
                    document.getElementById(areaMap[i]).style.backgroundColor = "#FFFFFF00";
                  }
                  if (c == 'y') {
                    document.getElementById(areaMap[i]).style.backgroundColor = "#bcbc0066";
                  }
                  if (c == 'g') {
                    document.getElementById(areaMap[i]).style.backgroundColor = "#49bc2966";
                  }
                }
              }
            }

            function markRegions(color) {
              var colorcode;
              if (selected) {
                for (var i = start_ind; i <= end_ind; i++) {
                  changeAreaColor(i, color);
                }
              }
              markSelected('selected');
            }
          </script>
        </div>

        <!-- Video panel -->
        <div class="seven columns">

          <iframe id="existing-iframe-example"
            width="640" height="360"
            src="https://www.youtube.com/embed/ferai1AuiOo?enablejsapi=1"
            frameborder="0"
            style="border: solid 4px #37474F"
            name="lesson-video"
          ></iframe>
          <input class="button-primary" type="button" value="Repeat segment" id="RepeatButton" href="#" onclick="change()">

          <script type="text/javascript">
            var tag = document.createElement('script');
            tag.id = 'iframe-demo';
            tag.src = 'https://www.youtube.com/iframe_api';
            var firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

            var player;
            var repeatVar;
            var repeat = false;
            function onYouTubeIframeAPIReady() {
              player = new YT.Player('existing-iframe-example', {
                  events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                  }
              });
            }

            function onPlayerReady(event) {
            }

            function onPlayerStateChange(event) {
              if (event.data == 1) {
                repeatVar = setInterval(repeatFunc,500);
              }
            }

            function change() {
              if (document.getElementById("RepeatButton").value == "Repeat segment"){
                clearInterval(repeatVar);
                repeatVar = setInterval(repeatFunc,500);
                repeat = true;
                document.getElementById("RepeatButton").value = "Stop repeat";
              }
              else {
                clearInterval(repeatVar);
                repeatVar = setInterval(repeatFunc,500);
                repeat = false;
                document.getElementById("RepeatButton").value = "Repeat segment";
              }
            }

            function repeatFunc(){
              t = player.getCurrentTime();
              getCurrentFrame(t);
              if (t >= endSeconds) {
                if (repeat) {
                  player.seekTo(startSeconds);
                }
                else {
                  clearInterval(repeatVar);
                  player.pauseVideo();
                }
              }
            }

            function getCurrentFrame(t){
              for (var i = 0; i < areaListLen; i++) {
                if (t > getArea(i).startTime && t < getArea(i).endTime) {
                  document.getElementById("cursor-line").style.left = getArea(i).x1 + "px";
                  break;
                }
              }
            }
          </script>
        </div>
      </div>
    </div>
  </div>

<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>
