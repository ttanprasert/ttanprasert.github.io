<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>PROTOTYPE 1</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">
  <link rel="stylesheet" href="css/custom.css">
  <link rel="stylesheet" href="css/jquery.Jcrop.css">

  <!-- Scripts
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="./jquery.Jcrop.js"></script>
  <script async src="https://www.youtube.com/iframe_api"></script>
  <script src="./data-guitar.js"></script>

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="images/favicon.png">

</head>
<body>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->

  <div class="section categories">
    <div class="container">
      <h2 class="section-heading">IDEA 1 PROTOTYPE</h2>
      <h5 class="section-heading">Score-based navigation and progress tracking </h5>
      <p class="section-description">
        The system presents the printout of annotation to navigate videos. 
        The learner can highlight a segment of the score and go to explanation or demonstration of that part in the video directly. 
        Moreover, the learner could color-code the part of the score that they have finished learning, playing the part at slow speed, 
        or playing at original speed. This will allow users to see annotation as references in their practices, monitor their progress, 
        and allow for a more effective semantic-based navigation. 
      </p><br>

      <div class="row">

        <!-- Sheet music panel -->
        <div class="five columns">
          <div class="wrapper">
            <img class="u max full width" id="target" src="images/dannyboy-guitar-1.png" width=100% alt="">
            <div class="vl" id="cursor-line" style="left: 45px; top: 114px"></div>
            <div class="box" id="area00" style="top:114px; left:50px; width:15px; height:14px;" onclick="javascript:goto(505)"></div>
            <div class="box" id="area01" style="top:114px; left:65px; width:15px; height:14px;" onclick="javascript:goto(507)"></div>
            <div class="box" id="area02" style="top:114px; left:80px; width:30px; height:14px;" onclick="javascript:goto(510)"></div>
            <div class="box" id="area03" style="top:114px; left:110px; width:15px; height:14px;" onclick="javascript:goto(512)"></div>
            <div class="box" id="area04" style="top:114px; left:125px; width:15px; height:14px;" onclick="javascript:goto(515)"></div>
            <div class="box" id="area05" style="top:114px; left:140px; width:20px; height:14px;" onclick="javascript:goto(517)"></div>
            <div class="box" id="area10" style="top:190px; left:14px; width:60px; height:14px;" onclick="javascript:goto(520)"></div>
            <div class="box" id="area11" style="top:190px; left:74px; width:50px; height:14px;" onclick="javascript:goto(522)"></div>
            <div class="box" id="area12" style="top:190px; left:124px; width:100px; height:14px;" onclick="javascript:goto(524)"></div>
            <div class="box" id="area13" style="top:190px; left:224px; width:60px; height:14px;" onclick="javascript:goto(526)"></div>
            <div class="box" id="area20" style="top:230px; left:14px; width:69px; height:14px;" onclick="javascript:goto(529)"></div>
            <div class="box" id="area21" style="top:230px; left:85px; width:49px; height:14px;" onclick="javascript:goto(531)"></div>
            <div class="box" id="area22" style="top:230px; left:134px; width:54px; height:14px;" onclick="javascript:goto(533)"></div>
            <div class="box" id="area23" style="top:230px; left:188px; width:54px; height:14px;" onclick="javascript:goto(535)"></div>
            <div class="box" id="area24" style="top:230px; left:242px; width:38px; height:14px;" onclick="javascript:goto(537)"></div>
            <div class="box" id="area30" style="top:270px; left:14px; width:79px; height:14px;" onclick="javascript:goto(545)"></div>
            <div class="box" id="area31" style="top:270px; left:94px; width:65px; height:14px;" onclick="javascript:goto(547)"></div>
            <div class="box" id="area32" style="top:270px; left:159px; width:55px; height:14px;" onclick="javascript:goto(550)"></div>
            <div class="box" id="area50" style="top:370px; left:14px; width:130px; height:14px;" onclick="javascript:goto(838)"></div>
            <div class="box" id="area51" style="top:370px; left:146px; width:80px; height:14px;" onclick="javascript:goto(843)"></div>
            <div class="box" id="area52" style="top:370px; left:226px; width:60px; height:14px;" onclick="javascript:goto(846)"></div>
            <div class="box" id="area60" style="top:410px; left:12px; width:117px; height:14px;" onclick="javascript:goto(849)"></div>
            <div class="box" id="area61" style="top:410px; left:129px; width:110px; height:14px;" onclick="javascript:goto(852)"></div>
            <div class="box" id="area62" style="top:410px; left:239px; width:37px; height:14px;" onclick="javascript:goto(854)"></div>
            <div class="box" id="area63" style="top:410px; left:276px; width:24px; height:14px;" onclick="javascript:goto(856)"></div>
            <div class="box" id="area70" style="top:450px; left:12px; width:95px; height:14px;" onclick="javascript:goto(858)"></div>
            <div class="box" id="area71" style="top:450px; left:107px; width:68px; height:14px;" onclick="javascript:goto(860)"></div>
            <div class="box" id="area72" style="top:450px; left:175px; width:34px; height:14px;" onclick="javascript:goto(862)"></div>
            <div class="box" id="area73" style="top:450px; left:209px; width:50px; height:14px;" onclick="javascript:goto(864)"></div>
            <div class="box" id="area80" style="top:488px; left:12px; width:81px; height:14px;" onclick="javascript:goto(873)"></div>
            <div class="box" id="area81" style="top:488px; left:93px; width:81px; height:14px;" onclick="javascript:goto(875)"></div>
            <div class="box" id="area82" style="top:488px; left:174px; width:78px; height:14px;" onclick="javascript:goto(876)"></div>
            <div class="box" id="area83" style="top:488px; left:252px; width:20px; height:14px;" onclick="javascript:goto(882)"></div>
            <div class="box" id="areaC0" style="top:165px; left:70px; width:12px; height:20px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(88, 100)"></div>
            <div class="box" id="areaC1" style="top:206px; left:82px; width:12px; height:14px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(88, 100)"></div>
            <div class="box" id="areaC2" style="top:245px; left:90px; width:12px; height:20px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(88, 100)"></div>
            <div class="box" id="areaC3" style="top:285px; left:72px; width:12px; height:20px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(88, 100)"></div>
            <div class="box" id="areaC4" style="top:285px; left:204px; width:12px; height:20px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(88, 100)"></div>
            <div class="box" id="areaC5" style="top:345px; left:80px; width:15px; height:14px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(88, 100)"></div>
            <div class="box" id="areaC6" style="top:345px; left:228px; width:15px; height:14px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(88, 100)"></div>
            <div class="box" id="areaC7" style="top:387px; left:76px; width:12px; height:14px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(88, 100)"></div>
            <div class="box" id="areaC8" style="top:426px; left:76px; width:12px; height:14px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(88, 100)"></div>
            <div class="box" id="areaC9" style="top:426px; left:190px; width:15px; height:14px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(88, 100)"></div>
            <div class="box" id="areaC10" style="top:467px; left:73px; width:15px; height:14px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(88, 100)"></div>
            <div class="box" id="areaC11" style="top:467px; left:238px; width:15px; height:14px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(88, 100)"></div>
            <div class="box" id="areaF0" style="top:165px; left:224px; width:12px; height:20px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(100, 111)"></div>
            <div class="box" id="areaF1" style="top:245px; left:206px; width:12px; height:20px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(100, 111)"></div>
            <div class="box" id="areaF2" style="top:342px; left:144px; width:12px; height:20px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(100, 111)"></div>
            <div class="box" id="areaF3" style="top:426px; left:112px; width:12px; height:20px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(100, 111)"></div>
            <div class="box" id="areaG0" style="top:206px; left:228px; width:15px; height:20px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(114, 121)"></div>
            <div class="box" id="areaG1" style="top:285px; left:128px; width:15px; height:20px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(114, 121)"></div>
            <div class="box" id="areaG2" style="top:387px; left:245px; width:15px; height:20px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(114, 121)"></div>
            <div class="box" id="areaG3" style="top:467px; left:159px; width:15px; height:15px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(114, 121)"></div>
            <div class="box" id="areaDm70" style="top:245px; left:260px; width:30px; height:20px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(151, 194)"></div>
            <div class="box" id="areaG70" style="top:206px; left:255px; width:20px; height:20px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(123, 127)"></div>
            <div class="box" id="areaG71" style="top:387px; left:272px; width:20px; height:20px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(123, 127)"></div>
            <div class="box" id="areaAm0" style="top:426px; left:218px; width:23px; height:20px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(864, 873)"></div>
            <div class="box" id="strumming" style="top:64px; left:180px; width:175px; height:30px; background-color:transparent; border: 2px solid orange" onclick="javascript:repeatAt(347, 503)"></div>
          </div>

          <script>

            var jcrop_api
            $(window).load(function(){
                jcrop_api = $.Jcrop('#target',{
                    onSelect: getOverlap,
                    onRelease: stopRepeat
                })
            })

            var startSeconds = 0;
            var endSeconds = 1102;
            var areaMap = ["area00", "area01", "area02", "area03", "area04", "area05", 
                            "area10", "area11", "area12", "area13", "area20", "area21", "area22", "area23", "area24", "area30", "area31", "area32", 
                            "area50", "area51", "area52", "area60", "area61", "area62", "area63", "area70", "area71", "area72", "area73", "area80", "area81", "area82", "area83"];

            var selected;
            var start_ind, end_ind;
            var areaListLen = getNumArea();

            function goto(t) {
                startSeconds = t;
                endSeconds = 1102;
                player.seekTo(startSeconds);
            }

            function repeatAt(t1, t2) {
                startSeconds = t1;
                endSeconds = t2;
                player.seekTo(startSeconds);
                getCurrentFrame(startSeconds);
                repeatVar = setInterval(repeatFunc,500);
            }

            function stopRepeat(){
              endSeconds = 1102;
            }

            function getOverlap(c) {
              var x1 = c.x;
              var y1 = c.y;
              var x2 = c.x+c.w;
              var y2 = c.y+c.h;

              console.log([x1, y1, x2, y2]);

              for (var i = 0; i < areaListLen; i++) {
                area = getArea(i);
                if (x1 < area.x1 && y1 < area.y1) {
                  start_ind = i;
                  break;
                }
              }
              
              for (var i = areaListLen-1; i >= 0; i--) {
                area = getArea(i);
                if (x2 > area.x2 && y2 > area.y2) {
                  end_ind = i;
                  break;
                }
              }
              startSeconds = getArea(start_ind).startTime;
              endSeconds = getArea(end_ind).endTime;

              player.seekTo(startSeconds);
              getCurrentFrame(startSeconds);
              repeatVar = setInterval(repeatFunc,500);
            }
          </script>
        </div>

        <!-- Video panel -->
        <div class="seven columns">

          <iframe id="existing-iframe-example"
            width="560" height="315"
            src="https://www.youtube.com/embed/0GHOJYCcI9Q?enablejsapi=1"
            frameborder="0"
            style="border: solid 4px #37474F"
            name="lesson-video"
          ></iframe>

          <script type="text/javascript">
            var tag = document.createElement('script');
            tag.id = 'iframe-demo';
            tag.src = 'https://www.youtube.com/iframe_api';
            var firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

            var player;
            var repeatVar;
            function onYouTubeIframeAPIReady() {
              player = new YT.Player('existing-iframe-example', {
                  events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                  }
              });
            }

            function onPlayerReady(event) {
            }

            function onPlayerStateChange(event) {
              if (event.data == 1) {
                repeatVar = setInterval(repeatFunc,500);
              }
            }

            function repeatFunc(){
              t = player.getCurrentTime();
              getCurrentFrame(t);
              if (t >= endSeconds) {
                  player.seekTo(startSeconds);
                }
            }

            function getCurrentFrame(t){
              for (var i = 0; i < areaListLen; i++) {
                if (t >= getArea(i).startTime && t < getArea(i).endTime) {
                  document.getElementById("cursor-line").style.left = getArea(i).x1 + "px";
                  document.getElementById("cursor-line").style.top = getHeight(i) + "px";
                  break;
                }
              }
            }

            /*focus();
            var listener = window.addEventListener('blur', function() {
                if (document.activeElement === document.getElementById('existing-iframe-example')) {
                    jcrop_api.release();
                }
                window.removeEventListener('blur', listener);
            });*/
          </script>
        </div>
      </div>
    </div>
  </div>

<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>
