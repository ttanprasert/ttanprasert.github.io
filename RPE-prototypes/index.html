<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>PROTOTYPE 1</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">
  <link rel="stylesheet" href="css/custom.css">

  <!-- Scripts
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-jcrop/0.9.15/css/jquery.Jcrop.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-jcrop/0.9.15/js/jquery.Jcrop.js"></script>
  <script async src="https://www.youtube.com/iframe_api"></script>

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="images/favicon.png">

</head>
<body>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div class="section categories">
    <div class="container">
      <h2 class="section-heading">IDEA 1 PROTOTYPE</h3>
      <h5 class="section-heading">Score-based navigation and progress tracking </h1>
      <p class="section-description">
        The system presents the printout of annotation to navigate videos. 
        The learner can highlight a segment of the score and go to explanation or demonstration of that part in the video directly. 
        Moreover, the learner could color-code the part of the score that they have finished learning, playing the part at slow speed, 
        or playing at original speed. This will allow users to see annotation as references in their practices, monitor their progress, 
        and allow for a more effective semantic-based navigation. 
      </p>
      <div class="row">

        <!-- Sheet music panel -->
        <div class="five columns">
          <div class="wrapper">
            <img class="u max full width" id="target" src="images/dannyboy-piano-1.png" width=100% alt="">
            <div class="box" id="area1" style="top:85px; left:92px; width:56px; height:55px;  background-color: yellow"></div>
            <div class="box" id="area2" style="top:85px; left:148px; width:52px; height:55px; background-color: transparent"></div>
            <div class="box" id="area3" style="top:85px; left:200px; width:40px; height:55px; background-color: transparent"></div>
          </div>
          <input class="button-primary" type="button" id="markGreen" value="Got it" onclick="markRegions('g')">
          <input class="button-primary" type="button" id="markRed" value="Not yet" onclick="markRegions('r')">
          <input class="button-primary" type="button" id="markTpr" value="Clear" onclick="markRegions('c')">

          <script>
            $(document).ready(function(){
                $('#target').Jcrop({
                    //onChange: getOverlap,
                    onSelect: getOverlap,
                    onRelease: releaseBox
                })
            })

            var startSeconds, endSeconds;

            var area1 = {x1:95, y1:88, x2:142, y2:137, startTime:4, endTime:8};
            var area2 = {x1:151, y1:88, x2:197, y2:137, startTime:8, endTime:10};
            var area3 = {x1:202, y1:88, x2:235, y2:137, startTime:10, endTime:12};
            var areaList = [area1, area2, area3];

            var selected;
            var start_ind, end_ind;

            function getOverlap(c) {
              selected = true;

              var x1 = c.x;
              var y1 = c.y;
              var x2 = c.x+c.w;
              var y2 = c.y+c.h;

              for (var i = 0; i < areaList.length; i++) {
                area = areaList[i];
                if (x1 < area.x1 && y1 < area.y1) {
                  startSeconds = area.startTime;
                  start_ind = i;
                  break;
                }
              }
              console.log([x1, y1, x2, y2]);
              
              for (var i = areaList.length-1; i >= 0; i--) {
                area = areaList[i];
                if (x2 > area.x2 && y2 > area.y2) {
                  endSeconds = area.endTime;
                  end_ind = i;
                  break;
                }
              }

              player.seekTo(startSeconds);
              repeatOff = setInterval(endSection,500);
            }

            function releaseBox(c) {
              selected = false;
            }
            
            function markRegions(color) {
              var colorcode;
              if (color == 'r') {
                colorcode = "#bc292966";
              }
              else if (color == 'g') {
                colorcode = "#49bc2966";
              }
              else if (color == 'c') {
                colorcode = "#00FFFFFF";
              }
              if (selected) {
                for (var i = start_ind; i <= end_ind; i++) {
                  if (i==0) { document.getElementById("area1").style.backgroundColor = colorcode; }
                  else if (i==1) { document.getElementById("area2").style.backgroundColor = colorcode; }
                  else if (i==2) { document.getElementById("area3").style.backgroundColor = colorcode; }
                  }
              }
            }
          </script>
        </div>

        <!-- Video panel -->
        <div class="seven columns">

          <iframe id="existing-iframe-example"
            width="640" height="360"
            src="https://www.youtube.com/embed/ferai1AuiOo?enablejsapi=1"
            frameborder="0"
            style="border: solid 4px #37474F"
            name="lesson-video"
          ></iframe>
          <input class="button-primary" type="button" value="Repeat segment" id="RepeatButton" href="#" onclick="change()">

          <script type="text/javascript">
            var tag = document.createElement('script');
            tag.id = 'iframe-demo';
            tag.src = 'https://www.youtube.com/iframe_api';
            var firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

            var player;
            var repeatOn, repeatOff;
            function onYouTubeIframeAPIReady() {
              player = new YT.Player('existing-iframe-example', {
                  events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                  }
              });
            }

            function onPlayerReady(event) {
            }

            function onPlayerStateChange(event) {
            }

            function change() {
              if (document.getElementById("RepeatButton").value == "Repeat segment"){
                clearInterval(repeatOff);
                repeatOn = setInterval(checkEndtime,500);
                document.getElementById("RepeatButton").value = "Stop repeat";
              }
              else {
                clearInterval(repeatOn);
                repeatOff = setInterval(endSection,500);
                document.getElementById("RepeatButton").value = "Repeat segment";
              }
            }

            function endSection(){
              if (player.getCurrentTime() >= endSeconds) {
                clearInterval(repeatOff);
                player.pauseVideo();
              }
            }

            function checkEndtime(){
              if (player.getCurrentTime() >= endSeconds) {
                player.seekTo(startSeconds);
              }
            }
          </script>
        </div>
      </div>
    </div>
  </div>

<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>
