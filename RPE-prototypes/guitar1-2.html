<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>PROTOTYPE 1</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton-custom.css">
  <link rel="stylesheet" href="css/custom.css">
  <link rel="stylesheet" href="css/jquery.Jcrop.css">

  <!-- Scripts
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="./jquery.Jcrop.js"></script>
  <script async src="https://www.youtube.com/iframe_api"></script>
  <script src="./data-guitar.js"></script>

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="images/favicon.png">

</head>
<body>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->

  <div class="section categories">
    <div class="container">
      <h2 class="section-heading">IDEA 1 PROTOTYPE</h2>
      <h5 class="section-heading">Score-based navigation and progress tracking </h5>
      <br><br>
      <div class="row">

        <!-- Sheet music panel -->
        <div class="five columns">
            <img class="chord" src="images/pattern-5-hr.png" style="position: absolute; top:190; left: 360; width:150px" onclick="javascript:repeatAt(347, 503)">
            <pre id="chordsheet" style="user-select: none;">
Intro: <mark id="0"> <a href="javascript:goto(505)">C</a> </mark><mark id="1"><a href="javascript:goto(507)">F</a> </mark><mark id="2"><a href="javascript:goto(510)">Dm7</a> </mark><mark id="3"><a href="javascript:goto(512)">C</a> </mark><mark id="4"><a href="kavascript:goto(515)">G</a> </mark><mark id="5"><a href="javascript:goto(517)">C</a> </mark>

Verse:
            <a class="chord" href="javascript:repeatAt(88, 100)">C</a>                        <a class="chord" href="javascript:repeatAt(101, 111)">F</a>
<mark id="6"> <a href="javascript:goto(520)">Oh,</a> </mark><mark id="7"><a href="javascript:goto(521)">Danny</a> </mark><mark id="8"><a href="javascript:goto(522)">boy,</a> </mark><mark id="9"><a href="javascript:goto(524)">the</a> </mark><mark id="10"><a href="javascript:goto(524)">pipes,</a> </mark><mark id="11"><a href="javascript:goto(525)">the</a> </mark><mark id="12"><a href="javascript:goto(525)">pipes</a> </mark><mark id="13"><a href="javascript:goto(526)">are</a> </mark><mark id="14"><a href="javascript:goto(527)">calling</a> </mark>
         <a class="chord" href="javascript:repeatAt(88, 100)">C</a>                  <a class="chord" href="javascript:repeatAt(114, 121)">G</a>       <a class="chord" href="javascript:repeatAt(123, 127)">G7</a>
<mark id="15"> <a href="javascript:goto(530)">From</a> </mark><mark id="16"><a href="javascript:goto(530)">glen</a> </mark><mark id="17"><a href="javascript:goto(531)">to</a> </mark><mark id="18"><a href="javascript:goto(531)">glen,</a> </mark><mark id="19"><a href="javascript:goto(533)">and</a> </mark><mark id="20"><a href="javascript:goto(534)">down</a> </mark><mark id="21"><a href="javascript:goto(534)">the</a> </mark><mark id="22"><a href="javascript:goto(535)">mountain</a></mark><mark id="23"><a href="javascript:goto(536)">side</mark>
         <a class="chord" href="javascript:repeatAt(88, 100)">C</a>                 <a class="chord" href="javascript:repeatAt(101, 111)">F</a>     <a class="chord" href="javascript:repeatAt(151, 194)">Dm7</a>
<mark id="24"> <a href="javascript:goto(545)">The</a> </mark><mark id="25"><a href="javascript:goto(546)">summer's</a> </mark><mark id="26"><a href="javascript:goto(547)">gone,</a> </mark><mark id="27"><a href="javascript:goto(549)">and</a> </mark><mark id="28"><a href="javascript:goto(550)">all</a> </mark>the roses falling
         <a class="chord" href="javascript:repeatAt(88, 100)">C</a>        <a class="chord" href="javascript:repeatAt(114, 121)">G</a>              <a class="chord" href="javascript:repeatAt(88, 100)">C</a>
 'Tis you 'tis you must go, and I must bide.


Chorus:
            <a class="chord" href="javascript:repeatAt(88, 100)">C</a>         <a class="chord" href="javascript:repeatAt(101, 111)">F</a>               <a class="chord" href="javascript:repeatAt(88, 100)">C</a>
<mark id="29"> <a href="javascript:goto(840)">But</a> </mark><mark id="30"><a href="javascript:goto(840)">come</a> </mark><mark id="31"><a href="javascript:goto(841)">ye</a> </mark><mark id="32"><a href="javascript:goto(841)">back</a> </mark><mark id="33"><a href="javascript:goto(843)">when</a> </mark><mark id="34"><a href="javascript:goto(844)">summer's</a> </mark><mark id="35"><a href="javascript:goto(845)">in</a> </mark><mark id="36"><a href="javascript:goto(845)">the</a> </mark><mark id="37"><a href="javascript:goto(846)">meadow,</a> </mark>
            <a class="chord" href="javascript:repeatAt(88, 100)">C</a>                   <a class="chord" href="javascript:repeatAt(114, 121)">G</a>          <a class="chord" href="javascript:repeatAt(123, 127)">G7</a>
<mark id="38"> <a href="javascript:goto(848)">or</a> </mark><mark id="39"><a href="javascript:goto(849)">when</a> </mark><mark id="40"><a href="javascript:goto(849)">the</a> </mark><mark id="41"><a href="javascript:goto(850)">valley's</a> </mark><mark id="42"><a href="javascript:goto(852)">hushed</a> </mark><mark id="43"><a href="javascript:goto(853)">and</a> </mark><mark id="44"><a href="javascript:goto(853)">white</a> </mark><mark id="45"><a href="javascript:goto(854)">with</a> </mark><mark id="46"><a href="javascript:goto(854)">snow.</a> </mark>
            <a class="chord" href="javascript:repeatAt(88, 100)">C</a>       <a class="chord" href="javascript:repeatAt(101, 111)">F</a>        <a class="chord" href="javascript:repeatAt(88, 100)">C</a>     <a class="chord" href="javascript:repeatAt(864, 873)">Am</a>
<mark id="47"> <a href="javascript:goto(857)">For</a> </mark><mark id="48"><a href="javascript:goto(857)">I'll</a> </mark><mark id="49"><a href="javascript:goto(858)">be</a> </mark><mark id="50"><a href="javascript:goto(858)">here</a> </mark><mark id="51"><a href="javascript:goto(860)">in</a> </mark><mark id="52"><a href="javascript:goto(860)">sunshine</a> </mark><mark id="53"><a href="javascript:goto(861)">or</a> </mark><mark id="54"><a href="javascript:goto(862)">in</a> </mark><mark id="55"><a href="javascript:goto(862)">shadow.</a> </mark>
          <a class="chord" href="javascript:repeatAt(88, 100)">C</a>              <a class="chord" href="javascript:repeatAt(114, 121)">G</a>               <a class="chord" href="javascript:repeatAt(88, 100)">C</a>
<mark id="56"> <a href="javascript:goto(873)">Oh,</a> </mark><mark id="57"><a href="javascript:goto(874)">Danny</a> </mark><mark id="58"><a href="javascript:goto(875)">boy,</a> </mark><mark id="59"><a href="javascript:goto(876)">oh,</a> </mark><mark id="60"><a href="javascript:goto(876)">Danny</a> </mark><mark id="61"><a href="javascript:goto(877)">boy,</a> </mark><mark id="62"><a href="javascript:goto(878)">I</a> </mark><mark id="63"><a href="javascript:goto(878)">love</a> </mark><mark id="64"><a href="javascript:goto(879)">you</a> </mark><mark id="65"><a href="javascript:goto(879)">so.</a> </mark>
            </pre>

        </div>

        <!-- Video panel -->
        <div class="seven columns">

          <iframe id="existing-iframe-example"
            width="640" height="360"
            src="https://www.youtube.com/embed/0GHOJYCcI9Q?enablejsapi=1"
            frameborder="0"
            style="position:absolute; left:540px; z-index: 600; border: solid 4px #37474F"
            name="lesson-video"
          ></iframe>
          <div><i class="triangle-down" id="leftMarker" style="position:absolute; left: 550px; bottom: 105px;"></i></div>
          <div><i class="triangle-up" id="rightMarker" style="position:absolute; left: 1165px; bottom: 95px;"></i></div>
          

        </div>
      </div>
    </div>
  </div>

<script type="text/javascript">

    var tag = document.createElement('script');
    tag.id = 'iframe-demo';
    tag.src = 'https://www.youtube.com/iframe_api';
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player;
    var repeatVar;
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('existing-iframe-example', {
            events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
            }
        });
    }

    var startSeconds = 0;
    var endSeconds = 1102;
    var mark1 = document.getElementById("leftMarker");
    var mark2 = document.getElementById("rightMarker");

    var tlist = [505, 507, 510, 512, 515, 517, 
        520, 521, 522, 524, 524, 525, 525, 526, 527,
        530, 530, 531, 531, 533, 534, 534, 535, 536,
        545, 546, 547, 549, 550,
        840, 840, 841, 841, 843, 844, 845, 845, 846,
        848, 849, 849, 850, 852, 853, 853, 854, 854,
        857, 857, 858, 858, 860, 860, 861, 862, 862,
        873, 874, 875, 876, 876, 877, 878, 878, 879, 879];

    function getSelectionText() {
        var text = "";
        var start, end;
        if (window.getSelection) {
            var selected = window.getSelection();
            text = selected.toString();
            start = selected.getRangeAt(0).startContainer.parentNode;
            end = selected.getRangeAt(0).endContainer.parentNode;
            if (start.nodeName == "A") {
                start = start.parentNode;
            }
            if (end.nodeName == "A") {
                end = end.parentNode;
            }
            return [Number(start.id), Number(end.id), text];
        }
    }

    function arrayEquals(a, b) {
        return Array.isArray(a) &&
            Array.isArray(b) &&
            a.length === b.length &&
            a.every((val, index) => val === b[index]);
    }

    var prevText = [];
    document.onmouseup = function() {
        var text = getSelectionText();
        if(!arrayEquals(prevText, text) && text[2]!="") {
            repeatAt(tlist[text[0]], tlist[text[1]+1], true);
        }
        else {
            clearSelection();
            stopRepeat();
        }
        prevText = text;
    };

    function goto(t) {
        startSeconds = t;
        endSeconds = 1102;
        player.seekTo(startSeconds);
    }

    function clearSelection()
    {
        if (window.getSelection) {window.getSelection().removeAllRanges();}
        else if (document.selection) {document.selection.empty();}
    }

    function repeatAt(t1, t2, lyric=false) {
        if (t2 == 838) {
            t2 = 568;
        }
        startSeconds = t1;
        endSeconds = t2;
        if (!lyric) {
            for(var i=0; i < 66; i++) {
                document.getElementById(String(i)).style.backgroundColor = "rgba(169, 236, 249, 0.7)";
            }
        }
        
        mark1.style.left = (t1*620/1102)+550 + "px";
        mark2.style.left = (t2*620/1102)+550 + "px";
        mark1.style.display = "block";
        mark2.style.display = "block";

        player.seekTo(startSeconds);
        clearInterval(repeatVar);
        
        repeatVar = setInterval(repeatFunc,500);
    }

    function stopRepeat(){
        endSeconds = 1102;
        mark1.style.display = "none";
        mark2.style.display = "none";
    }

    function onPlayerReady(event) {
        event.target.setVolume(8);
        $('#progressBar').on('click', function (e) {
            clearSelection();
            stopRepeat();
        });
    }

    function onPlayerStateChange(event) {
        if (event.data == 1) {
            repeatVar = setInterval(repeatFunc,500);
        }
        if (event.data == 2) {
            clearInterval(repeatVar);
        }
    }

    function repeatFunc(){
        t = player.getCurrentTime();
        console.log(t);
        if (t >= 505 && t <= 881) {
            getCurrentFrame(t);
        }
        if (t >= endSeconds) {
            player.seekTo(startSeconds);
        }
    }

    function getCurrentFrame(t){
        for(var i=0; i < 66; i++) {
            if (tlist[i] <= t && tlist[i+1] > t) {
                document.getElementById(String(i)).style.backgroundColor = "rgba(220, 80, 101, 0.6)";
            }
            else if (tlist[i] == tlist[i+1] && (tlist[i] <= t && tlist[i+2] > t)) {
                document.getElementById(String(i)).style.backgroundColor = "rgba(220, 80, 101, 0.6)";
            }
            else if (i >= 64 && t >= 879) {
                document.getElementById(String(i)).style.backgroundColor = "rgba(220, 80, 101, 0.6)";
            }
            else {
                document.getElementById(String(i)).style.backgroundColor = "rgba(169, 236, 249, 0.7)";
            }
        }
    }

</script>
<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>
